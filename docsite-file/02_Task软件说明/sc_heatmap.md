# **ScHeatMap**

　 
### **工具介绍**

　  
#### **功能概述**

ScHeatMap（热图），是不同样本的基因表达数据进行可视化展示的聚类分析工具。例如，将QuSAGE分析结果中不同细胞类群的基因集合（Gene Set）表达数据进行合并可视化展示，对比不同的细胞类群之间的基因集合表达情况，从而以整体视角对QuSAGE结果进行综合分析。

#### **工具特点**

ScHeatMap利用R语言中的pheatmap绘图包实现图片绘制。
ScHeatMap既可以纵向对比一个细胞类群中不同基因集合表达的情况，也可以横向对比不同细胞类群间同一个基因集合表达的情况。

　 
### **流程搭建**

　  
**上游工具**：QuSAGE / QuSAGEPathFilter等
**连接示例**：

 

　 
### **输入文件**

　  
#### **输入文件 表达量表格**
表达信息文件（必传文件）
说明：
本文件用于传入绘制热图用的数据矩阵
应用：
上游工具QuSAGE的结果文件:/QuSAGE_for_heatmap/GeneSetName_heatmap_input.txt，或/QuSAGE_for_heatmap/KEGG_GeneSetName_heatmap_input.txt，也可以导入重命名过的Seurat_ReCluster结果文件GraphClust.ClusterMeanValue.txt 
注：
1 传入一组表达量文件，会直接在热图中进行展示。
2 传入多组表达量文件（如Seurat_ReCluster的结果GraphClust.ClusterMeanValue.txt），会合并在一张热图中进行展示。并按照不同的表达信息表格文件名对x轴标签分组展示。

　  
#### **输入文件 y轴文件**
y轴信息文件（选传文件）
说明：
本文件用于导入与y轴相关的信息。通过传入y轴文件，可筛选y轴显示条目，也可更改y轴条目名称，还可设置y轴条目分组。
应用：
上游工具QuSAGEPathFilter的结果文件：metabolism.txt
文件格式要求：
第一列为原始y轴标签（来源于表达信息文件第一列，热图结果只出现此文件中包含的条目）
第二列为y轴重命名标签（不需要重命名，保持和第一列相同）
第三列为分组信息（例如基因所属通路，如果没有第三列，会对y轴条目进行聚类）
注：
列间隔请使用table制表符
示例：
|OriName|ReName |GroupInfo|
|:-----:|:-----:|:-------:|
|Gene1	|Gene1  |Group1   |
|Gene2	|GeneB  |Group2   |
|Gene3	|GeneC  |Group2   |
|...    |...    |...      |

　  
#### **输入文件 x轴文件**
x轴信息文件（选传文件）
说明：
本文件用于导入与x轴相关的信息。通过传入x轴文件，可筛选x轴显示条目，也可更改x轴条目名称，还可设置x轴条目分组。
本输入文件是可选文件。
文件格式要求：
第一列为原始x轴标签（来源于表达信息文件第一行，热图结果只出现此文件中包含的条目）
第二列为x轴重命名标签（不需要重命名，保持和第一列相同）
第三列为分组信息（例如细胞类群所属大类，可以没有第三列）
注：
列间隔请使用table制表符
如果输入了多个表达信息表格，默认按照表达信息表格名字作为x轴分组，本输入文件无效，请勿额外输入x轴文件。

示例：

|OriName |ReName  |GroupInfo|
|:------:|:------:|:-------:|
|Cluster1|Cluster1|Group1   |
|Cluster2|ClusterB|Group2   |
|Cluster3|ClusterC|Group2   |
|...     |...     |...      |

　 
### **参数设置**

<label id='color'> </label>
#### **运行参数 配色**
参数说明：
本参数控制热图配色。
默认为blue,white,red，表示低表达至高表达颜色从蓝经白到红渐变。支持自定义颜色。必填参数。

<label id='width'> </label>
#### **运行参数 图片宽度**
参数说明：
根据需要设置输出图片宽度。必填参数。

<label id='height'> </label>
#### **运行参数 图片高度**
参数说明：
根据需要设置输出图片高度。必填参数。
注：
如果基因无法全部显示，请调整高度。

<label id='key_adjust'> </label>
#### **运行参数 是否调整颜色范围**
参数说明：
是否要自定义颜色范围，如果结果图片使用的颜色范围不便于观察分析，可以勾选本参数，根据图片实际情况调整颜色范围，再重新作图。勾选本参数后，参数列表会显示col_start，col_end两个关联参数。

<label id='col_start'> </label>
#### **运行参数 col_start**
颜色范围下限
参数说明：
ColorBar最小值，勾选是否调整颜色范围后才会显示

<label id='col_end'> </label>
#### **运行参数 col_end**
颜色范围上限
参数说明：
ColorBar最大值，勾选是否调整颜色范围后才会显示

<label id='na_del'> </label>
#### **运行参数 是否删除NA行**
参数说明：
绘图时，删除表达信息文件中全部为空值的行。建议勾选。

<label id='scale_x'> </label>
#### **运行参数 横向标化**
参数说明：
勾选本参数会将表达信息文件每一行数据进行行内标化，以避免因数据差异过大而影响绘图效果。

<label id='scale_y'> </label>
#### **运行参数 纵向标化**
参数说明：
勾选本参数会将表达信息文件每一列数据进行列内标化，以避免因数据差异过大而影响绘图效果。

<label id='group_scale'> </label>
#### **运行参数 按照分组分别标化**
参数说明：
勾选本参数会在标化处理时，将表达信息文件数据按照分组信息分组，对各组分别进行组内标化；不勾选本参数，则会对全体数据进行全局标化。
注：
单独勾选按照分组标化并不会起作用，本参数要配合横向标化或纵向标化两个参数一起使用。

<label id='sort_x'> </label>
#### **运行参数 对x轴排序**
参数说明：
本参数会将x轴的标签按照数值或字母顺序进行升序排序。
注：
如果x轴输入文件中有分组信息，本参数无效，如果x轴输入文件仅有前两列则本参数依然有效。

<label id='Threads'> </label>
#### **运行参数 Threads**
线程数
参数说明：
设置线程数

<label id='memory'> </label>
#### **运行参数 Memory(MB)**
内存（MB）
参数说明：
设置内存大小

　 
### **结果解读**

　  
#### **结果文件结构**

├─ heatmap.png/pdf/svg （png/pdf/svg格式热图）

#### **HeatMap热图**
<div style="text-align:center">
<img data-src=".png" height="600px" ></img>
</div>
说明：
横轴标签表示细胞类群/样本名称。
纵轴标签表示基因/基因集合名称。
色块从蓝经白到红渐变表示表达程度的不同。
左侧及顶部的色条分别表示纵轴和横轴标签的分组信息。


文档更新：2019.12.22 技术部 李亚当
文档整理：2019.08.25 项目部 梅姗姗 / 技术部 李亚当
